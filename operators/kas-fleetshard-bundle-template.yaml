---
apiVersion: template.openshift.io/v1
kind: Template
metadata:
  name: kas-fleetshard
objects:
- apiVersion: operators.coreos.com/v1alpha1
  kind: CatalogSource
  metadata:
    name: kas-fleetshard-catalog
    namespace: ${NAMESPACE}
    labels:
      app: kas-fleetshard
  spec:
    sourceType: grpc
    secrets:
    - "rhoas-image-pull-secret"
    image: ${BUNDLE_IMAGE}
    displayName: Kas Fleetshard Catalog
    publisher: Data Plane Team
- apiVersion: operators.coreos.com/v1alpha1
  kind: Subscription
  metadata:
    name: kas-fleetshard-subscription
    namespace: ${NAMESPACE}
    labels:
      app.kubernetes.io/part-of: managed-kafka
      app.kubernetes.io/component: kas-fleetshard-operator
  spec:
    channel: alpha
    installPlanApproval: Automatic
    name: kas-fleetshard-operator
    source: kas-fleetshard-catalog
    sourceNamespace: ${NAMESPACE}
    config:
      resources:
        requests:
          memory: "1Gi"
          cpu: "500m"
        limits:
          memory: "1Gi"
          cpu: "500m"
      env:
      - name: SSO_ENABLED
        value: "true"
      - name: MANAGEDKAFKA_ADMINSERVER_EDGE_TLS_ENABLED
        value: "${MANAGEDKAFKA_ADMINSERVER_EDGE_TLS_ENABLED}"
      - name: STANDARD_KAFKA_CONTAINER_CPU
        value: 500m
      - name: STANDARD_KAFKA_CONTAINER_MEMORY
        value: 4Gi
      - name: STANDARD_KAFKA_JVM_XMS
        value: 1G
      - name: STANDARD_ZOOKEEPER_CONTAINER_CPU
        value: 500m
- apiVersion: operators.coreos.com/v1
  kind: OperatorGroup
  metadata:
    name: kas-fleetshard-operator
    namespace: ${NAMESPACE}

parameters:
- name: BUNDLE_IMAGE
  displayName: kas-strimzi-operator catalog image
  description: the image of the mas-sso-operator catalog to deploy
  required: true
- name: NAMESPACE
  value: "redhat-managed-kafka-operator"
  displayName: namespace to deploy into
  description: the namespace to deploy into
  required: true
- name: MANAGEDKAFKA_ADMINSERVER_EDGE_TLS_ENABLED
  value: "false"
